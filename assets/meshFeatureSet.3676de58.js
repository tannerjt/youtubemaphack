import{$ as u,a0 as d,iQ as mt,bL as dt,dz as yt,a1 as te,cf as ve,jD as Ge,k_ as xt,dy as Te,ba as tt,r as f,s as W,ce as z,aY as E,hE as wt,k$ as N,A as M,cq as _e,al as fe,a8 as C,gW as vt,l0 as $t,g8 as At,bI as bt,q as Mt,t as ie,f as Re,eP as Pe,f7 as nt,f6 as Se,fe as rt,fg as ge,eQ as Ft,C as ot,eY as me,gu as Tt,f5 as Rt,kS as st,a6 as it,Z as Dt,ij as Et,cD as Ot,cz as Ct,R as Lt,cv as De,ar as It,J as Ae,c_ as _t,cE as Pt}from"./index.768d9708.js";import{r as $e,M as St,x as jt,a as je,j as Ne,k as ze,O as Ue,h as We,L as ke,b as Nt,c as ae,g as Ee,l as Oe,d as zt,e as pe,f as de}from"./georeference.cf17966c.js";import{x as Ut}from"./earcut.d30cbec0.js";import{n as Wt}from"./deduplicate.c8a631b5.js";import{a as He}from"./quatf64.ddec7ef6.js";import{e as at}from"./mat4f64.a79dd289.js";var q;const be=new WeakMap;let kt=0,O=q=class extends ve{constructor(e){super(e),this.wrap="repeat"}get url(){return this._get("url")||null}set url(e){this._set("url",e),e&&this._set("data",null)}get data(){return this._get("data")||null}set data(e){this._set("data",e),e&&this._set("url",null)}writeData(e,n,t,r){if(e instanceof HTMLImageElement){const o={type:"image-element",src:Ge(e.src,r),crossOrigin:e.crossOrigin};n[t]=o}else if(e instanceof HTMLCanvasElement){const o=e.getContext("2d").getImageData(0,0,e.width,e.height),s={type:"canvas-element",imageData:this._encodeImageData(o)};n[t]=s}else if(e instanceof HTMLVideoElement){const o={type:"video-element",src:Ge(e.src,r),autoplay:e.autoplay,loop:e.loop,muted:e.muted,crossOrigin:e.crossOrigin,preload:e.preload};n[t]=o}else{const o={type:"image-data",imageData:this._encodeImageData(e)};n[t]=o}}readData(e){switch(e.type){case"image-element":{const n=new Image;return n.src=e.src,n.crossOrigin=e.crossOrigin,n}case"canvas-element":{const n=this._decodeImageData(e.imageData),t=document.createElement("canvas");return t.width=n.width,t.height=n.height,t.getContext("2d").putImageData(n,0,0),t}case"image-data":return this._decodeImageData(e.imageData);case"video-element":{const n=document.createElement("video");return n.src=e.src,n.crossOrigin=e.crossOrigin,n.autoplay=e.autoplay,n.loop=e.loop,n.muted=e.muted,n.preload=e.preload,n}default:return}}get transparent(){const e=this.data,n=this.url;if(e instanceof HTMLCanvasElement)return this._imageDataContainsTransparent(e.getContext("2d").getImageData(0,0,e.width,e.height));if(e instanceof ImageData)return this._imageDataContainsTransparent(e);if(n){const t=n.substr(n.length-4,4).toLowerCase(),r=n.substr(0,15).toLocaleLowerCase();if(t===".png"||r==="data:image/png;")return!0}return!1}set transparent(e){e!=null?this._override("transparent",e):this._clearOverride("transparent")}get contentHash(){const e=typeof this.wrap=="string"?this.wrap:typeof this.wrap=="object"?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",n=(t="")=>`d:${t},t:${this.transparent},w:${e}`;return this.url!=null?n(this.url):this.data!=null?this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement?n(this.data.src):(be.has(this.data)||be.set(this.data,++kt),n(be.get(this.data))):n()}clone(){const e={url:this.url,data:this.data,wrap:this._cloneWrap()};return new q(e)}cloneWithDeduplication(e){const n=e.get(this);if(n)return n;const t=this.clone();return e.set(this,t),t}_cloneWrap(){return typeof this.wrap=="string"?this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}}_encodeImageData(e){let n="";for(let t=0;t<e.data.length;t++)n+=String.fromCharCode(e.data[t]);return{data:btoa(n),width:e.width,height:e.height}}_decodeImageData(e){const n=atob(e.data),t=new Uint8ClampedArray(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return xt(t,e.width,e.height)}_imageDataContainsTransparent(e){for(let n=3;n<e.data.length;n+=4)if(e.data[n]!==255)return!0;return!1}static from(e){return typeof e=="string"?new q({url:e}):e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof ImageData||e instanceof HTMLVideoElement?new q({data:e}):Te(q,e)}};u([d({type:String,json:{write:mt}})],O.prototype,"url",null),u([d({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),d()],O.prototype,"data",null),u([dt("data")],O.prototype,"writeData",null),u([yt("data")],O.prototype,"readData",null),u([d({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],O.prototype,"transparent",null),u([d({json:{write:!0}})],O.prototype,"wrap",void 0),u([d({readOnly:!0})],O.prototype,"contentHash",null),O=q=u([te("esri.geometry.support.MeshTexture")],O);const se=O;var Ce;let L=Ce=class extends ve{constructor(e){super(e),this.color=null,this.colorTexture=null,this.normalTexture=null,this.alphaMode="auto",this.alphaCutoff=.5,this.doubleSided=!0}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,n){const t=f(e)?e.get(this):null;if(t)return t;const r=new Ce(this.clonePropertiesWithDeduplication(n));return f(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{color:f(this.color)?this.color.clone():null,colorTexture:f(this.colorTexture)?this.colorTexture.cloneWithDeduplication(e):null,normalTexture:f(this.normalTexture)?this.normalTexture.cloneWithDeduplication(e):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}}};u([d({type:tt,json:{write:!0}})],L.prototype,"color",void 0),u([d({type:se,json:{write:!0}})],L.prototype,"colorTexture",void 0),u([d({type:se,json:{write:!0}})],L.prototype,"normalTexture",void 0),u([d({nonNullable:!0,json:{write:!0}})],L.prototype,"alphaMode",void 0),u([d({nonNullable:!0,json:{write:!0}})],L.prototype,"alphaCutoff",void 0),u([d({nonNullable:!0,json:{write:!0}})],L.prototype,"doubleSided",void 0),L=Ce=u([te("esri.geometry.support.MeshMaterial")],L);const Be=L;var Le;let I=Le=class extends Be{constructor(e){super(e),this.emissiveColor=null,this.emissiveTexture=null,this.occlusionTexture=null,this.metallic=1,this.roughness=1,this.metallicRoughnessTexture=null}clone(){return this.cloneWithDeduplication(null,new Map)}cloneWithDeduplication(e,n){const t=f(e)?e.get(this):null;if(t)return t;const r=new Le(this.clonePropertiesWithDeduplication(n));return f(e)&&e.set(this,r),r}clonePropertiesWithDeduplication(e){return{...super.clonePropertiesWithDeduplication(e),emissiveColor:f(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:f(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(e):null,occlusionTexture:f(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(e):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:f(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(e):null}}};u([d({type:tt,json:{write:!0}})],I.prototype,"emissiveColor",void 0),u([d({type:se,json:{write:!0}})],I.prototype,"emissiveTexture",void 0),u([d({type:se,json:{write:!0}})],I.prototype,"occlusionTexture",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],I.prototype,"metallic",void 0),u([d({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],I.prototype,"roughness",void 0),u([d({type:se,json:{write:!0}})],I.prototype,"metallicRoughnessTexture",void 0),I=Le=u([te("esri.geometry.support.MeshMaterialMetallicRoughness")],I);const Ht=I;var he;const H=W.getLogger("esri.geometry.support.MeshVertexAttributes");let b=he=class extends ve{constructor(e){super(e),this.color=null,this.position=new Float64Array(0),this.uv=null,this.normal=null,this.tangent=null}castColor(e){return Y(e,Uint8Array,[Uint8ClampedArray],{loggerTag:".color=",stride:4},H)}castPosition(e){return e&&e instanceof Float32Array&&H.warn(".position=","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array"),Y(e,Float64Array,[Float32Array],{loggerTag:".position=",stride:3},H)}castUv(e){return Y(e,Float32Array,[Float64Array],{loggerTag:".uv=",stride:2},H)}castNormal(e){return Y(e,Float32Array,[Float64Array],{loggerTag:".normal=",stride:3},H)}castTangent(e){return Y(e,Float32Array,[Float64Array],{loggerTag:".tangent=",stride:4},H)}clone(){const e={position:E(this.position),uv:E(this.uv),normal:E(this.normal),tangent:E(this.tangent),color:E(this.color)};return new he(e)}clonePositional(){const e={position:E(this.position),normal:E(this.normal),tangent:E(this.tangent),uv:this.uv,color:this.color};return new he(e)}};function Me(e,n,t,r){const{loggerTag:o,stride:s}=n;return e.length%s!=0?(r.error(o,`Invalid array length, expected a multiple of ${s}`),new t([])):e}function Y(e,n,t,r,o){if(!e)return e;if(e instanceof n)return Me(e,r,n,o);for(const s of t)if(e instanceof s)return Me(new n(e),r,n,o);if(Array.isArray(e))return Me(new n(e),r,n,o);{const s=t.map(i=>`'${i.name}'`);return o.error(`Failed to set property, expected one of ${s}, but got ${e.constructor.name}`),new n([])}}function ne(e,n,t){n[t]=Bt(e)}function Bt(e){const n=new Array(e.length);for(let t=0;t<e.length;t++)n[t]=e[t];return n}u([d({json:{write:ne}})],b.prototype,"color",void 0),u([z("color")],b.prototype,"castColor",null),u([d({nonNullable:!0,json:{write:ne}})],b.prototype,"position",void 0),u([z("position")],b.prototype,"castPosition",null),u([d({json:{write:ne}})],b.prototype,"uv",void 0),u([z("uv")],b.prototype,"castUv",null),u([d({json:{write:ne}})],b.prototype,"normal",void 0),u([z("normal")],b.prototype,"castNormal",null),u([d({json:{write:ne}})],b.prototype,"tangent",void 0),u([z("tangent")],b.prototype,"castTangent",null),b=he=u([te("esri.geometry.support.MeshVertexAttributes")],b);var oe;const Gt=W.getLogger("esri.geometry.support.MeshComponent");let _=oe=class extends ve{constructor(e){super(e),this.faces=null,this.material=null,this.shading="source",this.trustSourceNormals=!1}static from(e){return Te(oe,e)}castFaces(e){return Y(e,Uint32Array,[Uint16Array],{loggerTag:".faces=",stride:3},Gt)}castMaterial(e){return Te(e&&typeof e=="object"&&("metallic"in e||"roughness"in e||"metallicRoughnessTexture"in e)?Ht:Be,e)}clone(){return new oe({faces:E(this.faces),shading:this.shading,material:E(this.material),trustSourceNormals:this.trustSourceNormals})}cloneWithDeduplication(e,n){const t={faces:E(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(e,n):null,trustSourceNormals:this.trustSourceNormals};return new oe(t)}};u([d({json:{write:!0}})],_.prototype,"faces",void 0),u([z("faces")],_.prototype,"castFaces",null),u([d({type:Be,json:{write:!0}})],_.prototype,"material",void 0),u([z("material")],_.prototype,"castMaterial",null),u([d({type:String,json:{write:!0}})],_.prototype,"shading",void 0),u([d({type:Boolean})],_.prototype,"trustSourceNormals",void 0),_=oe=u([te("esri.geometry.support.MeshComponent")],_);const K=_;function Vt(e){const n=qt(e.rings,e.hasZ,ye.CCW_IS_HOLE),t=[];let r=0,o=0;for(const a of n.polygons){const l=a.count,c=a.index,g=new Float64Array(n.position.buffer,3*c*n.position.BYTES_PER_ELEMENT,3*l),m=a.holeIndices.map(h=>h-c),p=new Uint32Array(Ut(g,m,3));t.push({position:g,faces:p}),r+=g.length,o+=p.length}const s=Zt(t,r,o),i=Wt(s.position.buffer,6,{originalIndices:s.faces});return s.position=new Float64Array(i.buffer),s.faces=i.indices,s}function Zt(e,n,t){if(e.length===1)return e[0];const r=new Float64Array(n),o=new Uint32Array(t);let s=0,i=0,a=0;for(const l of e){for(let c=0;c<l.position.length;c++)r[s++]=l.position[c];for(let c=0;c<l.faces.length;c++)o[i++]=l.faces[c]+a;a=s/3}return{position:r,faces:o}}function qt(e,n,t){const r=e.length,o=new Array(r),s=new Array(r),i=new Array(r);let a=0,l=0,c=0,g=0;for(let h=0;h<r;++h)g+=e[h].length;const m=new Float64Array(3*g);let p=0;for(let h=r-1;h>=0;h--){const y=e[h],T=t===ye.CCW_IS_HOLE&&Yt(y);if(T&&r!==1)o[a++]=y;else{let v=y.length;for(let x=0;x<a;++x)v+=o[x].length;const $={index:p,pathLengths:new Array(a+1),count:v,holeIndices:new Array(a)};$.pathLengths[0]=y.length,y.length>0&&(i[c++]={index:p,count:y.length}),p=T?le(y,y.length-1,-1,m,p,y.length,n):le(y,0,1,m,p,y.length,n);for(let x=0;x<a;++x){const A=o[x];$.holeIndices[x]=p,$.pathLengths[x+1]=A.length,A.length>0&&(i[c++]={index:p,count:A.length}),p=le(A,0,1,m,p,A.length,n)}a=0,$.count>0&&(s[l++]=$)}}for(let h=0;h<a;++h){const y=o[h];y.length>0&&(i[c++]={index:p,count:y.length}),p=le(y,0,1,m,p,y.length,n)}return l<r&&(s.length=l),c<r&&(i.length=c),{position:m,polygons:s,outlines:i}}function le(e,n,t,r,o,s,i){o*=3;for(let a=0;a<s;++a){const l=e[n];r[o++]=l[0],r[o++]=l[1],r[o++]=i?l[2]:0,n+=t}return o/3}function Yt(e){return!wt(e,!1,!1)}var ye;(function(e){e[e.NONE=0]="NONE",e[e.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(ye||(ye={}));const Ie=W.getLogger("esri.geometry.support.meshUtils.centerAt");function Jt(e,n,t){var o;if(!e.vertexAttributes||!e.vertexAttributes.position)return;const r=(o=t==null?void 0:t.origin)!=null?o:e.origin;f(e.transform)?((t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&Ie.warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),Xt(e.transform,n,r)):$e(e.spatialReference,t)?Qt(e,n,r):Kt(e,n,r)}function Xt(e,n,t){const r=n.x-t.x,o=n.y-t.y,s=n.hasZ&&t.hasZ?n.z-t.z:0,i=e.origin;e.origin=[i[0]+r,i[1]+o,i[2]+s]}function Qt(e,n,t){const r=St(e.vertexAttributes,t,{geographic:!0}),{position:o,normal:s,tangent:i}=jt(r,n,{geographic:!0});e.vertexAttributes.position=o,e.vertexAttributes.normal=s,e.vertexAttributes.tangent=i,e.vertexAttributesChanged()}function Kt(e,n,t){const r=nn,o=tn;if(N(n,o,e.spatialReference)){if(!N(t,r,e.spatialReference)){const s=e.origin;r[0]=s.x,r[1]=s.y,r[2]=s.z,Ie.error(`Failed to project specified origin (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}en(e.vertexAttributes.position,o,r),e.vertexAttributesChanged()}else Ie.error(`Failed to project centerAt location (wkid:${n.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid})`)}function en(e,n,t){if(e)for(let r=0;r<e.length;r+=3)for(let o=0;o<3;o++)e[r+o]+=n[o]-t[o]}const tn=M(),nn=M();async function rn(e,n,t){const{loadGLTFMesh:r}=await _e(fe(()=>import("./loadGLTFMesh.dc2ba8a6.js"),["assets/loadGLTFMesh.dc2ba8a6.js","assets/index.768d9708.js","assets/index.c493d9f8.css","assets/quatf64.ddec7ef6.js","assets/BufferView.f00ca1c3.js","assets/vec33.550f9c16.js","assets/DefaultMaterial_COLOR_GAMMA.4d10f970.js","assets/types.cb734ee5.js","assets/mat4f64.a79dd289.js","assets/enums.de935fa5.js","assets/Version.ce726869.js","assets/quat.6c15b560.js","assets/vectorStacks.edda7f42.js","assets/lineSegment.bee26d9f.js","assets/georeference.cf17966c.js","assets/earcut.d30cbec0.js","assets/deduplicate.c8a631b5.js"]),t),o=await lt(n,t),s=r(new C({x:0,y:0,z:0,spatialReference:e.spatialReference}),o.url,{resolveFile:on(o),useTransform:!0,signal:f(t)?t.signal:null});s.then(()=>o.dispose(),()=>o.dispose());const{vertexAttributes:i,components:a}=await s;e.vertexAttributes=i,e.components=a}function on(e){const n=vt(e.url);return t=>{var s;const r=$t(t,n,n),o=r?r.replace(/^ *\.\//,""):null;return(s=e.files.get(o))!=null?s:t}}async function lt(e,n){return e instanceof Blob?ee.fromBlob(e):typeof e=="string"?new ee(e):Array.isArray(e)?sn(e,n):an(e,n)}async function sn(e,n){const t=new Map;let r=null;const o=await At(e.map(async i=>({name:i.name,source:await lt(i instanceof Blob?i:i.source,n)}))),s=[];for(const i of o)i&&(bt(n)?i.source.dispose():s.push(i));Mt(n);for(const{name:i,source:a}of s)(ie(r)||/\.(gltf|glb)/i.test(i))&&(r=a.url),t.set(i,a.url),a.files&&a.files.forEach((l,c)=>t.set(c,l));if(ie(r))throw new Re("mesh-load-external:missing-files","Missing files to load external mesh source");return new ee(r,()=>s.forEach(({source:i})=>i.dispose()),t)}async function an(e,n){const{default:t}=await _e(fe(()=>import("./index.768d9708.js").then(o=>o.l4),["assets/index.768d9708.js","assets/index.c493d9f8.css"]),n),r=typeof e.multipart[0]=="string"?await Promise.all(e.multipart.map(async o=>(await t(o,{responseType:"array-buffer"})).data)):e.multipart;return ee.fromBlob(new Blob(r))}class ee{constructor(n,t=()=>{},r=new Map){this.url=n,this.dispose=t,this.files=r}static fromBlob(n){const t=URL.createObjectURL(n);return new ee(t,()=>URL.revokeObjectURL(t))}}const ln=W.getLogger("esri.geometry.support.meshUtils.offset");function cn(e,n,t){e.vertexAttributes&&e.vertexAttributes.position&&(f(e.transform)?((t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&ln.warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`),un(e.transform,n)):$e(e.spatialReference,t)?pn(e,n):hn(e,n))}function un(e,n){const t=e.origin;e.origin=Pe(M(),t,n)}function pn(e,n){const t=e.spatialReference,r=e.vertexAttributes.position,o=e.vertexAttributes.normal,s=e.vertexAttributes.tangent,i=new Float64Array(r.length),a=f(o)?new Float32Array(o.length):null,l=f(s)?new Float32Array(s.length):null,c=e.extent.center,g=fn;nt(t,[c.x,c.y,c.z],Ve,Se(t)),rt(Ze,Ve),ge(g,n,Ze),je(r,t,i),f(o)&&Ne(o,r,i,t,a),f(s)&&ze(s,r,i,t,l),ct(i,g),Ue(i,r,t),f(o)&&We(a,r,i,t,o),f(s)&&ke(l,r,i,t,s),e.vertexAttributesChanged()}function hn(e,n){ct(e.vertexAttributes.position,n),e.vertexAttributesChanged()}function ct(e,n){if(e)for(let t=0;t<e.length;t+=3)for(let r=0;r<3;r++)e[t+r]+=n[r]}const fn=M(),Ve=at(),Ze=He();function gn(){const{faceDescriptions:e,faceVertexOffsets:n,uvScales:t}=An,r=4*e.length,o=new Float64Array(3*r),s=new Float32Array(3*r),i=new Float32Array(2*r),a=new Uint32Array(2*e.length*3);let l=0,c=0,g=0,m=0;for(let p=0;p<e.length;p++){const h=e[p],y=l/3;for(const v of n)a[m++]=y+v;const T=h.corners;for(let v=0;v<4;v++){const $=T[v];let x=0;i[g++]=.25*t[v][0]+h.uvOrigin[0],i[g++]=h.uvOrigin[1]-.25*t[v][1];for(let A=0;A<3;A++)h.axis[A]!==0?(o[l++]=.5*h.axis[A],s[c++]=h.axis[A]):(o[l++]=.5*$[x++],s[c++]=0)}}return{position:o,normal:s,uv:i,faces:a}}function mn(e,n){const t=e.components[0],r=t.faces,o=bn[n],s=6*o,i=new Uint32Array(6),a=new Uint32Array(r.length-6);let l=0,c=0;for(let g=0;g<r.length;g++)g>=s&&g<s+6?i[l++]=r[g]:a[c++]=r[g];if(f(e.vertexAttributes.uv)){const g=new Float32Array(e.vertexAttributes.uv),m=4*o*2,p=[0,1,1,1,1,0,0,0];for(let h=0;h<p.length;h++)g[m+h]=p[h];e.vertexAttributes.uv=g}return e.components=[new K({faces:i,material:t.material}),new K({faces:a})],e}function dn(e=0){const n=Math.round(8*2**e),t=2*n,r=(n-1)*(t+1)+2*t,o=new Float64Array(3*r),s=new Float32Array(3*r),i=new Float32Array(2*r),a=new Uint32Array(3*((n-1)*t*2));let l=0,c=0,g=0,m=0;for(let p=0;p<=n;p++){const h=p/n*Math.PI+.5*Math.PI,y=Math.cos(h),T=Math.sin(h);w[2]=T;const v=p===0||p===n,$=v?t-1:t;for(let x=0;x<=$;x++){const A=x/$*2*Math.PI;w[0]=-Math.sin(A)*y,w[1]=Math.cos(A)*y;for(let P=0;P<3;P++)o[l]=.5*w[P],s[l]=w[P],++l;i[c++]=(x+(v?.5:0))/t,i[c++]=p/n,p!==0&&x!==t&&(p!==n&&(a[g++]=m,a[g++]=m+1,a[g++]=m-t),p!==1&&(a[g++]=m,a[g++]=m-t,a[g++]=m-t-1)),m++}}return{position:o,normal:s,uv:i,faces:a}}function yn(e=0){const t=Math.round(16*2**e),r=(5-1)*(t+1)+2*t,o=new Float64Array(3*r),s=new Float32Array(3*r),i=new Float32Array(2*r),a=new Uint32Array(3*(4*t));let l=0,c=0,g=0,m=0,p=0;for(let h=0;h<=5;h++){const y=h===0||h===5,T=h<=1||h>=5-1,v=h===2||h===4,$=y?t-1:t;for(let x=0;x<=$;x++){const A=x/$*2*Math.PI,P=y?0:.5;w[0]=P*Math.sin(A),w[1]=P*-Math.cos(A),w[2]=h<=2?.5:-.5;for(let k=0;k<3;k++)o[l++]=w[k],s[c++]=T?k===2?h<=1?1:-1:0:k===2?0:w[k]/P;i[g++]=(x+(y?.5:0))/t,i[g++]=h<=1?1*h/3:h<=3?1*(h-2)/3+1/3:1*(h-4)/3+2/3,v||h===0||x===t||(h!==5&&(a[m++]=p,a[m++]=p+1,a[m++]=p-t),h!==1&&(a[m++]=p,a[m++]=p-t,a[m++]=p-t-1)),p++}}return{position:o,normal:s,uv:i,faces:a}}function xn(e,n){const t=typeof n=="number"?n:n!=null?n.width:1,r=typeof n=="number"?n:n!=null?n.height:1;switch(e){case"up":case"down":return{width:t,depth:r};case"north":case"south":return{width:t,height:r};case"east":case"west":return{depth:t,height:r}}}function wn(e){const n=re.facingAxisOrderSwap[e],t=re.position,r=re.normal,o=new Float64Array(t.length),s=new Float32Array(r.length);let i=0;for(let a=0;a<4;a++){const l=i;for(let c=0;c<3;c++){const g=n[c],m=Math.abs(g)-1,p=g>=0?1:-1;o[i]=t[l+m]*p,s[i]=r[l+m]*p,i++}}return{position:o,normal:s,uv:new Float32Array(re.uv),faces:new Uint32Array(re.faces),isPlane:!0}}const B=1,G=2,V=3,re={position:[-.5,-.5,0,.5,-.5,0,.5,.5,0,-.5,.5,0],normal:[0,0,1,0,0,1,0,0,1,0,0,1],uv:[0,1,1,1,1,0,0,0],faces:[0,1,2,0,2,3],facingAxisOrderSwap:{east:[V,B,G],west:[-V,-B,G],north:[-B,V,G],south:[B,-V,G],up:[B,G,V],down:[B,-G,-V]}};function ce(e,n,t){e.isPlane||vn(e),$n(e,t&&t.size);const{vertexAttributes:r,transform:o}=Nt(e,n,t);return{vertexAttributes:new b({...r,uv:e.uv}),transform:o,components:[new K({faces:e.faces,material:t&&t.material||null})],spatialReference:n.spatialReference}}function vn(e){for(let n=0;n<e.position.length;n+=3)e.position[n+2]+=.5}function $n(e,n){if(n==null)return;const t=typeof n=="number"?[n,n,n]:[n.width!=null?n.width:1,n.depth!=null?n.depth:1,n.height!=null?n.height:1];S[0]=t[0],S[4]=t[1],S[8]=t[2];for(let r=0;r<e.position.length;r+=3){for(let o=0;o<3;o++)w[o]=e.position[r+o];ge(w,w,S);for(let o=0;o<3;o++)e.position[r+o]=w[o]}if(t[0]!==t[1]||t[1]!==t[2]){S[0]=1/t[0],S[4]=1/t[1],S[8]=1/t[2];for(let r=0;r<e.normal.length;r+=3){for(let o=0;o<3;o++)w[o]=e.normal[r+o];ge(w,w,S),Ft(w,w);for(let o=0;o<3;o++)e.normal[r+o]=w[o]}}}const An={faceDescriptions:[{axis:[0,-1,0],uvOrigin:[0,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[1,0,0],uvOrigin:[.25,.625],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,1,0],uvOrigin:[.5,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[-1,0,0],uvOrigin:[.75,.625],corners:[[1,-1],[-1,-1],[-1,1],[1,1]]},{axis:[0,0,1],uvOrigin:[0,.375],corners:[[-1,-1],[1,-1],[1,1],[-1,1]]},{axis:[0,0,-1],uvOrigin:[0,.875],corners:[[-1,1],[1,1],[1,-1],[-1,-1]]}],uvScales:[[0,0],[1,0],[1,1],[0,1]],faceVertexOffsets:[0,1,2,0,2,3]},bn={south:0,east:1,north:2,west:3,up:4,down:5},w=M(),S=He(),ut=W.getLogger("esri.geometry.support.meshUtils.rotate");function Mn(e,n,t){var o,s;if(!e.vertexAttributes||!e.vertexAttributes.position||n[3]===0)return;const r=e.spatialReference;if(f(e.transform)){(t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&ut.warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const i=(o=t==null?void 0:t.origin)!=null?o:e.transform.getOriginPoint(r);Fn(e.transform,n,i)}else{const i=(s=t==null?void 0:t.origin)!=null?s:e.origin;$e(e.spatialReference,t)?Tn(e,n,i):Rn(e,n,i)}}function Fn(e,n,t){const r=ot(J,t.x,t.y,t.z),o=me(J,r,e.origin);e.applyLocalInverse(o,qe),e.rotation=Ee(e.rotation,n,ae()),e.applyLocalInverse(o,o),me(o,o,qe),e.translation=Pe(M(),e.translation,o)}function Tn(e,n,t){const r=e.spatialReference,o=Se(r),s=pt;N(t,s,o)||N(e.origin,s,o);const i=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(i.length),g=f(a)?new Float32Array(a.length):null,m=f(l)?new Float32Array(l.length):null;nt(o,s,xe,o),rt(Je,xe);const p=Ye;ge(Oe(Ye),Oe(n),Je),p[3]=n[3],je(i,r,c),f(a)&&Ne(a,i,c,r,g),f(l)&&ze(l,i,c,r,m),Q(c,p,3,s),Ue(c,i,r),f(a)&&(Q(g,p,3),We(g,i,c,r,a)),f(l)&&(Q(m,p,4),ke(m,i,c,r,l)),e.vertexAttributesChanged()}function Rn(e,n,t){const r=pt;if(!N(t,r,e.spatialReference)){const o=e.origin;r[0]=o.x,r[1]=o.y,r[2]=o.z,ut.error(`Failed to project specified origin (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}Q(e.vertexAttributes.position,n,3,r),Q(e.vertexAttributes.normal,n,3),Q(e.vertexAttributes.tangent,n,4),e.vertexAttributesChanged()}function Q(e,n,t,r=st){if(!ie(e)){Tt(xe,zt(n),Oe(n));for(let o=0;o<e.length;o+=t){for(let s=0;s<3;s++)J[s]=e[o+s]-r[s];Rt(J,J,xe);for(let s=0;s<3;s++)e[o+s]=J[s]+r[s]}}}const J=M(),qe=M(),Ye=ae(),xe=at(),Je=He(),pt=M(),ht=W.getLogger("esri.geometry.support.meshUtils.scale");function Dn(e,n,t){var o;if(!e.vertexAttributes||!e.vertexAttributes.position)return;const r=e.spatialReference;if(f(e.transform)){(t==null?void 0:t.geographic)!=null&&t.geographic!==e.transform.geographic&&ht.warn(`Specifying the 'geographic' parameter (${t.geographic}) different from the Mesh transform setting (${e.transform.geographic}) is not supported`);const s=(o=t==null?void 0:t.origin)!=null?o:e.transform.getOriginPoint(r);En(e.transform,n,s)}else{const s=$e(e.spatialReference,t),i=t&&t.origin||e.origin;s?On(e,n,i):Cn(e,n,i)}}function En(e,n,t){const r=ot(X,t.x,t.y,t.z),o=me(X,r,e.origin);e.applyLocalInverse(o,Xe);const s=it(M(),e.scale,n);e.scale=s,e.applyLocalInverse(o,o),me(o,o,Xe),e.translation=Pe(M(),e.translation,o)}function On(e,n,t){const r=e.spatialReference,o=Se(r),s=gt;N(t,s,o)||N(e.origin,s,o);const i=e.vertexAttributes.position,a=e.vertexAttributes.normal,l=e.vertexAttributes.tangent,c=new Float64Array(i.length),g=f(a)?new Float32Array(a.length):null,m=f(l)?new Float32Array(l.length):null;je(i,r,c),f(a)&&Ne(a,i,c,r,g),f(l)&&ze(l,i,c,r,m),ft(c,n,s),Ue(c,i,r),f(a)&&We(g,i,c,r,a),f(l)&&ke(m,i,c,r,l),e.vertexAttributesChanged()}function Cn(e,n,t){const r=gt;if(!N(t,r,e.spatialReference)){const o=e.origin;r[0]=o.x,r[1]=o.y,r[2]=o.z,ht.error(`Failed to project specified origin (wkid:${t.spatialReference.wkid}) to mesh spatial reference (wkid:${e.spatialReference.wkid}).`)}ft(e.vertexAttributes.position,n,r),e.vertexAttributesChanged()}function ft(e,n,t=st){if(e)for(let r=0;r<e.length;r+=3){for(let o=0;o<3;o++)X[o]=e[r+o]-t[o];it(X,X,n);for(let o=0;o<3;o++)e[r+o]=X[o]+t[o]}}const X=M(),Xe=M(),gt=M();var D;const R=W.getLogger("esri.geometry.Mesh");let F=D=class extends Dt(Et.LoadableMixin(Ot(Ct))){constructor(e){super(e),this.components=null,this.transform=null,this.external=null,this.hasZ=!0,this.hasM=!1,this.vertexAttributes=new b,this.type="mesh"}initialize(){(ie(this.external)||this.vertexAttributes.position.length)&&(this.loadStatus="loaded"),this.when(()=>{this.handles.add(Lt(()=>{var e;return{vertexAttributes:this.vertexAttributes,components:(e=this.components)==null?void 0:e.map(n=>n.clone()),transform:f(this.transform)?this.transform.clone():null}},()=>this._set("external",null),{once:!0,sync:!0}))})}get hasExtent(){return!this.loaded&&f(this.external)&&f(this.external.extent)||this.loaded&&this.vertexAttributes.position.length>0&&(!this.components||this.components.length>0)}get boundingInfo(){const e=this.vertexAttributes.position,n=this.spatialReference;if(e.length===0||this.components&&this.components.length===0)return{extent:new De({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:n}),center:new C({x:0,y:0,z:0,spatialReference:n})};const t=f(this.transform)?this.transform.project(e,n):e;let r=1/0,o=1/0,s=1/0,i=-1/0,a=-1/0,l=-1/0,c=0,g=0,m=0;const p=t.length,h=1/(p/3);let y=0;for(;y<p;){const T=t[y++],v=t[y++],$=t[y++];r=Math.min(r,T),o=Math.min(o,v),s=Math.min(s,$),i=Math.max(i,T),a=Math.max(a,v),l=Math.max(l,$),c+=h*T,g+=h*v,m+=h*$}return{extent:new De({xmin:r,ymin:o,zmin:s,xmax:i,ymax:a,zmax:l,spatialReference:n}),center:new C({x:c,y:g,z:m,spatialReference:n})}}get anchor(){if(f(this.transform))return this.transform.getOriginPoint(this.spatialReference);const e=this.boundingInfo;return new C({x:e.center.x,y:e.center.y,z:e.extent.zmin,spatialReference:this.spatialReference})}get origin(){return f(this.transform)?this.transform.getOriginPoint(this.spatialReference):this.boundingInfo.center}get extent(){return!this.loaded&&f(this.external)&&f(this.external.extent)?this.external.extent.clone():this.boundingInfo.extent}addComponent(e){this.loaded?(this.components||(this.components=[]),this.components.push(K.from(e)),this.notifyChange("components")):R.error("addComponent()","Mesh must be loaded before applying operations")}removeComponent(e){if(this.loaded){if(this.components){const n=this.components.indexOf(e);if(n!==-1)return this.components.splice(n,1),void this.notifyChange("components")}R.error("removeComponent()","Provided component is not part of the list of components")}else R.error("removeComponent()","Mesh must be loaded before applying operations")}rotate(e,n,t,r){return pe(Fe.x,e,Z),pe(Fe.y,n,Qe),pe(Fe.z,t,Ke),Ee(Z,Qe,Z),Ee(Z,Ke,Z),Mn(this,Z,r),this}offset(e,n,t,r){return this.loaded?(ue[0]=e,ue[1]=n,ue[2]=t,cn(this,ue,r),this):(R.error("offset()","Mesh must be loaded before applying operations"),this)}scale(e,n){return this.loaded?(Dn(this,e,n),this):(R.error("scale()","Mesh must be loaded before applying operations"),this)}centerAt(e,n){return this.loaded?(Jt(this,e,n),this):(R.error("centerAt()","Mesh must be loaded before applying operations"),this)}load(e){return f(this.external)&&this.addResolvingPromise(rn(this,this.external.source,e)),Promise.resolve(this)}clone(){const e=this.components?new Map:null,n=this.components?new Map:null,t={components:this.components?this.components.map(r=>r.cloneWithDeduplication(e,n)):null,spatialReference:this.spatialReference,vertexAttributes:this.vertexAttributes.clone(),transform:f(this.transform)?this.transform.clone():null,external:f(this.external)?{source:this.external.source,extent:f(this.external.extent)?this.external.extent.clone():null}:null};return new D(t)}vertexAttributesChanged(){this.notifyChange("vertexAttributes")}async toBinaryGLTF(e){const{toBinaryGLTF:n}=await fe(()=>import("./gltfexport.6355703c.js"),["assets/gltfexport.6355703c.js","assets/index.768d9708.js","assets/index.c493d9f8.css","assets/quat.6c15b560.js","assets/quatf64.ddec7ef6.js","assets/georeference.cf17966c.js","assets/mat4f64.a79dd289.js","assets/BufferView.f00ca1c3.js","assets/vec33.550f9c16.js","assets/enums.de935fa5.js","assets/imageutils.48960265.js","assets/earcut.d30cbec0.js","assets/deduplicate.c8a631b5.js"]);return n(this,e)}static createBox(e,n){if(!(e instanceof C))return R.error(".createBox()","expected location to be a Point instance"),null;const t=new D(ce(gn(),e,n));return n&&n.imageFace&&n.imageFace!=="all"?mn(t,n.imageFace):t}static createSphere(e,n){return e instanceof C?new D(ce(dn(n&&n.densificationFactor||0),e,n)):(R.error(".createSphere()","expected location to be a Point instance"),null)}static createCylinder(e,n){return e instanceof C?new D(ce(yn(n&&n.densificationFactor||0),e,n)):(R.error(".createCylinder()","expected location to be a Point instance"),null)}static createPlane(e,n){var o;if(!(e instanceof C))return R.error(".createPlane()","expected location to be a Point instance"),null;const t=(o=n==null?void 0:n.facing)!=null?o:"up",r=xn(t,n==null?void 0:n.size);return new D(ce(wn(t),e,{...n,size:r}))}static createFromPolygon(e,n){if(!(e instanceof It))return R.error(".createFromPolygon()","expected polygon to be a Polygon instance"),null;const t=Vt(e);return new D({vertexAttributes:new b({position:t.position}),components:[new K({faces:t.faces,shading:"flat",material:n&&n.material||null})],spatialReference:e.spatialReference})}static async createFromGLTF(e,n,t){if(!(e instanceof C))throw R.error(".createfromGLTF()","expected location to be a Point instance"),new Re("invalid-input","Expected location to be a Point instance");const{loadGLTFMesh:r}=await _e(fe(()=>import("./loadGLTFMesh.dc2ba8a6.js"),["assets/loadGLTFMesh.dc2ba8a6.js","assets/index.768d9708.js","assets/index.c493d9f8.css","assets/quatf64.ddec7ef6.js","assets/BufferView.f00ca1c3.js","assets/vec33.550f9c16.js","assets/DefaultMaterial_COLOR_GAMMA.4d10f970.js","assets/types.cb734ee5.js","assets/mat4f64.a79dd289.js","assets/enums.de935fa5.js","assets/Version.ce726869.js","assets/quat.6c15b560.js","assets/vectorStacks.edda7f42.js","assets/lineSegment.bee26d9f.js","assets/georeference.cf17966c.js","assets/earcut.d30cbec0.js","assets/deduplicate.c8a631b5.js"]),t);return new D(await r(e,n,t))}static createWithExternalSource(e,n,t){var i,a,l;const r=(i=t==null?void 0:t.extent)!=null?i:null,o=(a=t==null?void 0:t.transform.clone())!=null?a:new de;o.origin=[e.x,e.y,(l=e.z)!=null?l:0];const s=e.spatialReference;return new D({external:{source:n,extent:r},transform:o,spatialReference:s})}static createIncomplete(e,n){var s,i;const t=(s=n==null?void 0:n.transform.clone())!=null?s:new de;t.origin=[e.x,e.y,(i=e.z)!=null?i:0];const r=e.spatialReference,o=new D({transform:t,spatialReference:r});return o.addResolvingPromise(Promise.reject(new Re("mesh-incomplete","Mesh resources are not complete"))),o}};u([d({type:[K],json:{write:!0}})],F.prototype,"components",void 0),u([d({type:de,json:{write:!0}})],F.prototype,"transform",void 0),u([d({constructOnly:!0})],F.prototype,"external",void 0),u([d({readOnly:!0})],F.prototype,"hasExtent",null),u([d({readOnly:!0})],F.prototype,"boundingInfo",null),u([d({readOnly:!0})],F.prototype,"anchor",null),u([d({readOnly:!0})],F.prototype,"origin",null),u([d({readOnly:!0,json:{read:!1}})],F.prototype,"extent",null),u([d({readOnly:!0,json:{read:!1,write:!0,default:!0}})],F.prototype,"hasZ",void 0),u([d({readOnly:!0,json:{read:!1,write:!0,default:!1}})],F.prototype,"hasM",void 0),u([d({type:b,nonNullable:!0,json:{write:!0}})],F.prototype,"vertexAttributes",void 0),F=D=u([te("esri.geometry.Mesh")],F);const Fe={x:Ae(1,0,0),y:Ae(0,1,0),z:Ae(0,0,1)},Z=ae(),Qe=ae(),Ke=ae(),ue=M(),et=F;var U,we;(function(e){e.featureGUID="featureGUID",e.assetName="assetName",e.hash="hash",e.type="type",e.conversionStatus="conversionStatus",e.flags="flags",e.complexity="complexity",e.size="size",e.seqNo="seqNo",e.sourceHash="sourceHash",e.assetURL="assetURL"})(U||(U={})),function(e){e.SUBMITTED="SUBMITTED",e.INPROGRESS="INPROGRESS",e.FAILED="FAILED",e.COMPLETED="COMPLETED"}(we||(we={}));function Ln(e,n,t){const r=t.features;t.features=[],delete t.geometryType;const o=_t.fromJSON(t);o.geometryType="mesh";const s=o.spatialReference,i=ie(e.outFields)||!e.outFields.length?()=>({}):In(e.outFields.includes("*")?null:new Set(e.outFields));for(const a of r){const l=_n(a,s,n);f(l)&&o.features.push(new Pt({geometry:l,attributes:i(a)}))}return o}function In(e){return({attributes:n})=>{if(!n)return{};if(!e)return n;for(const t in n)e.has(t)||delete n[t];return n}}function _n(e,n,t){const{status:r,source:o}=jn(e);if(r===j.FAILED)return null;const s=Pn(e,n,t),i=De.fromJSON(e.geometry);i.spatialReference=n;const a=Sn(e,t);return r===j.PENDING?et.createIncomplete(s,{extent:i,transform:a}):et.createWithExternalSource(s,o,{extent:i,transform:a})}function Pn({attributes:e},n,{transformFieldRoles:t}){return new C({x:e[t.originX],y:e[t.originY],z:e[t.originZ],spatialReference:n})}function Sn({attributes:e,assetMappings:n},{transformFieldRoles:t}){var r;return new de({translation:[e[t.translationX],e[t.translationY],e[t.translationZ]],rotation:pe([e[t.rotationX],e[t.rotationY],e[t.rotationZ]],e[t.rotationDeg]),scale:[e[t.scaleX],e[t.scaleY],e[t.scaleZ]],geographic:!((r=n[U.flags])!=null&&r.includes("PROJECT_VERTICES"))})}function jn(e){if(!e.assetMappings)return{status:j.FAILED};const n=[],t=new Map;for(const r of e.assetMappings){const o=r[U.seqNo],s=r[U.assetName],i=r[U.assetURL],a=r[U.conversionStatus];if(a===we.FAILED)return{status:j.FAILED};if(a!==we.COMPLETED)return{status:j.PENDING};if(o==null)n.push({name:s,source:i});else{const l=t.get(s);let c;l?c=l.multipart:(c=[],n.push({name:s,source:{multipart:c}}),t.set(s,{multipart:c})),c[o]=i}}return{status:j.COMPLETED,source:n}}var j;(function(e){e[e.FAILED=0]="FAILED",e[e.PENDING=1]="PENDING",e[e.COMPLETED=2]="COMPLETED"})(j||(j={}));const Bn=Object.freeze(Object.defineProperty({__proto__:null,meshFeatureSetFromJSON:Ln},Symbol.toStringTag,{value:"Module"}));export{Bn as a,Ht as c,K as f,se as m,b as p};
